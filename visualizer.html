<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钢琴指法可视化器</title>
    <link rel="stylesheet" href="visualizer.css">
</head>
<body>
    <div class="header">
        <h1>🎹 钢琴指法可视化器</h1>
        <p>带指法标注的钢琴卷帘窗视图</p>
    </div>

    <div class="main-container">
        <!-- 控制面板 -->
        <div class="control-panel">
            <h2>控制面板</h2>

            <!-- 播放控制 -->
            <div class="control-group">
                <label>播放控制:</label>
                <div class="playback-buttons">
                    <button id="play-btn" class="playback-btn">▶ 播放</button>
                    <button id="pause-btn" class="playback-btn">⏸ 暂停</button>
                    <button id="stop-btn" class="playback-btn">⏹ 停止</button>
                </div>
                <div class="speed-control">
                    <label>速度:</label>
                    <select id="playback-speed">
                        <option value="0.25">0.25x</option>
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1.0x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2.0x</option>
                    </select>
                </div>
            </div>

            <!-- 进度条 -->
            <div class="control-group">
                <label>进度:</label>
                <div class="time-display">
                    <span id="current-time-display">0.00</span>s / <span id="total-time-display">0.00</span>s
                </div>
                <input type="range" id="progress-slider" min="0" max="100" value="0" step="0.1">
            </div>

            <!-- 音频控制 -->
            <div class="control-group">
                <label>音频:</label>
                <label class="checkbox-label">
                    <input type="checkbox" id="enable-audio">
                    <span>🔊 启用声音</span>
                </label>
                <div class="volume-control" style="margin-top: 8px;">
                    <label>音量:</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="30" style="width: 100%;">
                </div>
                <button id="sustain-pedal-btn" class="pedal-button" style="margin-top: 8px;">
                    🎯 延音踏板: 关闭
                </button>
            </div>

            <div class="control-group">
                <label>加载JSON文件:</label>
                <input type="file" id="file-input" accept=".json">
                <button id="load-sample-btn">加载示例数据</button>
            </div>

            <div class="control-group">
                <label>手部显示:</label>
                <label class="checkbox-label">
                    <input type="checkbox" id="show-left-hand" checked>
                    <span class="hand-indicator left-hand"></span>
                    左手
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="show-right-hand" checked>
                    <span class="hand-indicator right-hand"></span>
                    右手
                </label>
            </div>

            <div class="control-group">
                <label>键盘范围:</label>
                <select id="octave-range">
                    <option value="full">完整 (88键)</option>
                    <option value="treble">高音区 (C4-B5)</option>
                    <option value="bass">低音区 (A2-C4)</option>
                </select>
            </div>

            <div class="control-group">
                <label>缩放:</label>
                <input type="range" id="zoom-slider" min="50" max="300" value="100">
                <span id="zoom-value">100%</span>
            </div>

            <div class="legend">
                <h3>图例</h3>
                <div class="legend-item">
                    <span class="legend-color right-hand"></span>
                    右手
                </div>
                <div class="legend-item">
                    <span class="legend-color left-hand"></span>
                    左手
                </div>
                <div class="legend-item">
                    <span class="finger-badge">1-5</span>
                    音符上的指法编号
                </div>
            </div>
        </div>

        <!-- 钢琴卷帘窗容器 -->
        <div class="piano-roll-wrapper">
            <div id="piano-roll-container">
                <!-- 键盘Canvas -->
                <canvas id="keyboard-canvas"></canvas>
                <!-- 音符Canvas -->
                <canvas id="notes-canvas"></canvas>
                <!-- 播放线覆盖层Canvas -->
                <canvas id="overlay-canvas"></canvas>
            </div>

            <!-- 信息面板 -->
            <div class="info-panel">
                <div class="info-item">
                    <span class="info-label">总音符数:</span>
                    <span id="total-notes">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">时长:</span>
                    <span id="total-duration">0.0s</span>
                </div>
                <div class="info-item">
                    <span class="info-label">音高范围:</span>
                    <span id="pitch-range">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">已分配指法:</span>
                    <span id="assigned-fingerings">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 工具提示 -->
    <div id="tooltip" class="tooltip"></div>

    <!-- 脚本 -->
    <script src="audio-engine.js"></script>
    <script src="visualizer.js"></script>
</body>
</html>
