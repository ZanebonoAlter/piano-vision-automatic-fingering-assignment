# 滚动模式说明

## 🎵 新功能：滚动音符显示

现在可视化器采用**滚动模式（Scrolling Mode）**，音符会从上方落下，当到达红色播放线时表示应该按下该键。

## 🎹 工作原理

### 视觉效果
```
┌──────────────────────────────┐
│  ┌──键盘区域──┐              │
│  │            │              │
│  │  C3  C4    │   ↑ 向上流动 │
│  │  □  □      │   ●(2)       │
│  │     ◾      │        ●(1)  │
│  │  □  □      │   ●(3)       │
│  │════════════│══════════════│ ← 红色播放线（固定）
│  └────────────┘              │
└──────────────────────────────┘
```

### 关键概念

1. **红色播放线固定**：位于键盘底部，表示"按键时刻"
2. **音符向下流动**：音符从屏幕上方落下
3. **到达播放线**：当音符顶部碰到红色线时，就该按键了

## 🕐 时间对应关系

```javascript
// 音符Y坐标计算
y = keyHeight + ((note.time - currentTime) * pixelsPerSecond)

// 当 note.time == currentTime 时
// → y = keyHeight（音符刚好到达键盘）
```

- **note.time > currentTime**: 音符在键盘上方（还未到按键时间）
- **note.time == currentTime**: 音符到达键盘（现在按键！）
- **note.time < currentTime**: 音符已穿过键盘（按键已完成）

## 🎮 使用场景

1. **练习指法**
   - 观察音符何时到达播放线
   - 在正确时刻按下对应手指
   - 学习指法转换

2. **慢速练习**
   - 将速度调至 0.5x 或 0.25x
   - 有足够时间准备手指位置
   - 专注于正确的指法

3. **预览乐曲**
   - 使用 1.5x 或 2.0x 速度
   - 快速浏览整首曲子
   - 了解指法安排

## ⚙️ 技术细节

### 性能优化
- **视锥剔除（Frustum Culling）**: 只绘制可见区域内的音符
  ```javascript
  if (y + height < 0 || y > canvasHeight) {
      return; // 跳过不可见音符
  }
  ```

- **按需重绘**: 播放时才重新绘制音符，暂停时不消耗资源

### 动画循环
```javascript
animate() {
    // 1. 更新当前时间
    this.currentTime += deltaTime * this.playbackSpeed;

    // 2. 重新绘制所有音符（新位置）
    this.drawNotes();

    // 3. 绘制固定的播放线
    this.drawPlayhead();

    // 4. 继续动画
    requestAnimationFrame(() => this.animate());
}
```

## 🎯 与传统模式的对比

### 传统钢琴卷帘窗（固定）
- 音符位置固定
- 播放线移动
- 适合编辑和查看整体结构

### 滚动模式（当前实现）
- 音符位置移动
- 播放线固定
- 适合练习和实时演奏

## 💡 使用提示

1. **准备时间**: 音符从屏幕顶端出现，给你充足的准备时间
2. **节奏感**: 观察音符间距，感受乐曲节奏
3. **指法记忆**: 反复练习，记住指法转换
4. **分段练习**: 拖动进度条到难点段落，反复练习

## 🔧 可自定义参数

在 `visualizer.js` 的 `config` 对象中：

```javascript
this.config = {
    keyHeight: 80,           // 键盘高度
    pixelsPerSecond: 100,    // 滚动速度（像素/秒）
    zoom: 1.0                // 缩放级别
};
```

调整这些参数可以改变视觉效果：
- `keyHeight` 越大 → 键盘越大
- `pixelsPerSecond` 越大 → 音符间距越宽
- `zoom` 越大 → 整体放大

## 🎓 学习建议

1. **初学者**: 0.5x 速度，专注于正确指法
2. **进阶**: 1.0x 速度，练习流畅性
3. **熟练**: 1.5x 速度，挑战快速曲目
4. **大师**: 2.0x 速度，测试反应极限

享受练习！🎹
